<?xml version="1.0" encoding="ISO-8859-1"?>
<metadata>
  <exportInfo>
    <exportTime>20/12/2019 18:31:19</exportTime>
    <systemVersion>4.0b90</systemVersion>
    <systemCharSet>ISO-8859-1</systemCharSet>
    <dbMetadata>
      <dbUser>SANKHYA</dbUser>
      <urlConnection><![CDATA[jdbc:oracle:thin:@192.168.1.65:1521/orcl]]></urlConnection>
      <jdbcDriver><![CDATA[Oracle JDBC driver 12.1.0.1.0]]></jdbcDriver>
      <DBMS><![CDATA[Oracle - Oracle Database 12c Enterprise Edition Release 12.1.0.2.0 - 64bit Production
With the Partitioning, OLAP, Advanced Analytics and Real Application Testing options]]></DBMS>
    </dbMetadata>
  </exportInfo>
  <menu description="Fech. Com. Integrado - Recria" name="MENU_ADICIONAL_0C34B71D280A74B3FD90A50BD8F44BAA">
    <properties>
      <tipoLancador><![CDATA[TA]]></tipoLancador>
      <resourceID><![CDATA[br.com.sankhya.menu.adicional.AD_TSFFCR]]></resourceID>
      <entityName><![CDATA[AD_TSFFCR]]></entityName>
      <contexto><![CDATA[mge]]></contexto>
    </properties>
  </menu>
  <instances>
    <instance name="AD_TSFTCPOVO">
      <instanceDescription><![CDATA[Custo Principal]]></instanceDescription>
      <tableInfo name="AD_TSFTCPOVO" sequenceType="M">
        <category><![CDATA[Integração - Comissão Postura]]></category>
        <tableDescription><![CDATA[Custo Ovo]]></tableDescription>
        <primaryKey>
          <CODTABPOS />
          <DTREF />
        </primaryKey>
      </tableInfo>
      <fields>
        <field name="CODTABPOS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Cód. Tabela]]></description>
        </field>
        <field name="DTREF" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Dt. Referência]]></description>
        </field>
        <field name="VLROVO" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Custo]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
      </fields>
    </instance>
    <instance name="AD_TSFFCR">
      <instanceDescription><![CDATA[Comissão Integrado Recria]]></instanceDescription>
      <tableInfo name="AD_TSFFCR" sequenceType="M">
        <category><![CDATA[Integrado - Comissão Recria]]></category>
        <telaDescription><![CDATA[Autor: M. Rangel
Tela de Fechamento de Comissão da Recria]]></telaDescription>
        <tableDescription><![CDATA[Comissão Integrado Recria]]></tableDescription>
        <primaryKey>
          <CODCENCUS />
          <CODPARC />
          <NUMLOTE />
        </primaryKey>
      </tableInfo>
      <fields>
        <field name="CODCENCUS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N" size="10">
          <description><![CDATA[Cód. Centro de Resultados]]></description>
        </field>
        <field name="CODPARC" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N" size="10">
          <description><![CDATA[Cód. Parceiro]]></description>
        </field>
        <field name="NUMLOTE" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N" size="10">
          <description><![CDATA[Nro Lote]]></description>
        </field>
        <field name="STATUS" systemField="N" dataType="S" presentationType="O" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Status do Fechamento]]></description>
          <expression><![CDATA[if($valorCampo == null){
 return "P";
} else {
 return $valorCampo;
}]]></expression>
          <options>
            <option value="P"><![CDATA[Pendente]]></option>
            <option value="A"><![CDATA[Em Andamento]]></option>
            <option value="F" default="S"><![CDATA[Finalizado]]></option>
          </options>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="CODEMP" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="S" size="5">
          <description><![CDATA[Cód. Empresa]]></description>
        </field>
        <field name="DTALOJ" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Dt. Alojamento]]></description>
        </field>
        <field name="QTDMESES" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Meses]]></description>
        </field>
        <field name="QTDAVES" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Qtd. Aves Alojadas]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="PERCMORTPREV" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Mortalidade Prevista (%)]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="CODTABPREV" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S" size="10">
          <description><![CDATA[Tabela Previsão]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="DREFTABPREV" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Dt. Ref. Tabela Previsto]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="STATUSLOTE" systemField="N" dataType="S" presentationType="O" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Situação do Lote]]></description>
          <expression><![CDATA[if($valorCampo == null){
 return "A";
}$valorCampo;]]></expression>
          <options>
            <option value="A"><![CDATA[Aberto]]></option>
            <option value="F" default="S"><![CDATA[Fechado]]></option>
          </options>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="VLRUNITPREV" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Unit. Previsto]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="VLRTOTPREV" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Total Previsto]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[S]]></prop>
          </properties>
        </field>
        <field name="VLRMESPREV" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Mensal Previsto]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="CODTABREAL" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S" size="10">
          <description><![CDATA[Tabela real]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="DREFTABREAL" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Dt. Ref. Tabela Real]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="VLRCOMFIXA" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Comissão Fixa]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="VLRCOMATRAT" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Bônus Atratividade]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="PONTUACAO" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Pontuação]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="VLRCOMCLIST" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Bônus CheckList]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="TOTREMAVE" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Total Remuneração por Ave]]></description>
          <properties>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="TOTREMMES" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Remuneração]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="PERCPARTICIP" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Participação (%)]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="PARTICIPACAO" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Participação Aves]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Cálculo p/ Remuneração]]></prop>
          </properties>
        </field>
        <field name="VLRCOMAVE" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Comissão por Ave]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="QTDAVESLIQ" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Qtd. Aves p/ Remuneração]]></description>
          <properties>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="QTDMORTPERM" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Qtd. Mortes Toleradas]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="QTDMORTGRANJA" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Qtd. Mortes na Granja]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="QTDAVESVDA" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Qtd. Aves Vendidas]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="QTDAVESELIM" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Qtd. Aves Eliminadas]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="TOTAVESTRANSF" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Total de Aves Transferidas]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="VLRMEDREAL" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Médio Mensal Real]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="VLRTOTREAL" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Total Realizado]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Memória de Cálculo]]></prop>
          </properties>
        </field>
        <field name="VLRTOTADIANT" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Total de Adiantamentos]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Resumo Financeiro]]></prop>
          </properties>
        </field>
        <field name="SALDO" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Saldo]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Resumo Financeiro]]></prop>
          </properties>
        </field>
        <field name="NUNOTA" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="N" visibleOnSearch="S" allowNull="S" size="10">
          <description><![CDATA[Nro. Único]]></description>
          <properties>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="UIGroupName"><![CDATA[Resumo Financeiro]]></prop>
          </properties>
        </field>
        <field name="STATUSNOTA" systemField="N" dataType="S" presentationType="O" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Situação da Nota/Pedido]]></description>
          <options>
            <option value="A"><![CDATA[Atendimento]]></option>
            <option value="L"><![CDATA[Liberada]]></option>
            <option value="P" default="S"><![CDATA[Pendente]]></option>
          </options>
          <properties>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="UIGroupName"><![CDATA[Resumo Financeiro]]></prop>
          </properties>
        </field>
        <field name="CODUSUINC" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="S" size="5">
          <description><![CDATA[Cód. Usuário Inclusão]]></description>
          <expression><![CDATA[if ($valorCampo == null ){
 return $ctx_usuario_logado;
}$valorCampo;]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Histórico de Alterações]]></prop>
          </properties>
        </field>
        <field name="DHINC" systemField="N" dataType="H" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Dh. Inclusão]]></description>
          <expression><![CDATA[if($valorCampo == null){
 return $ctx_dh_atual;
}$valorCampo;]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Histórico de Alterações]]></prop>
          </properties>
        </field>
        <field name="CODUSUALT" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="S" size="5">
          <description><![CDATA[Cód. Usuário Alter.]]></description>
          <expression><![CDATA[return $ctx_usuario_logado;]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Histórico de Alterações]]></prop>
          </properties>
        </field>
        <field name="DHALTER" systemField="N" dataType="H" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Dh. Alter.]]></description>
          <expression><![CDATA[$ctx_dh_atual]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="UIGroupName"><![CDATA[Histórico de Alterações]]></prop>
          </properties>
        </field>
      </fields>
      <relationShip>
        <relation entityName="Parceiro" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TGFPAR" />
          <expression><![CDATA[@ref-param[auto-search=true;description=Parceiros]this.CODPARC in (select codparc from ad_tsffciinc)]]></expression>
          <fields>
            <field localName="CODPARC" targetName="CODPARC" />
          </fields>
        </relation>
        <relation entityName="Empresa" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TSIEMP" />
          <fields>
            <field localName="CODEMP" targetName="CODEMP" />
          </fields>
        </relation>
        <relation entityName="CentroResultado" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TSICUS" />
          <expression><![CDATA[this.CODCENCUS in (select codcencus from ad_tsffciinc)]]></expression>
          <fields>
            <field localName="CODCENCUS" targetName="CODCENCUS" />
          </fields>
        </relation>
        <relation entityName="Usuario" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TSIUSU" />
          <fields>
            <field localName="CODUSUINC" targetName="CODUSU" />
          </fields>
        </relation>
        <relation entityName="CabecalhoNota" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TGFCAB" />
          <fields>
            <field localName="NUNOTA" targetName="NUNOTA" />
          </fields>
        </relation>
        <relation entityName="Usuario" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TSIUSU" />
          <fields>
            <field localName="CODUSUALT" targetName="CODUSU" />
          </fields>
        </relation>
        <relation entityName="AD_TSFTCP" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="N" tableName="AD_TSFTCP" />
          <fields>
            <field localName="CODTABPREV" targetName="CODTABPOS" />
          </fields>
        </relation>
        <relation entityName="AD_TSFTCP" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="N" tableName="AD_TSFTCP" />
          <fields>
            <field localName="CODTABREAL" targetName="CODTABPOS" />
          </fields>
        </relation>
        <relation entityName="AD_TSFFCRADT" type="I" insert="N" update="N" remove="S">
          <targetInfo systemInstance="N" tableName="AD_TSFFCRADT" />
          <fields>
            <field localName="NUMLOTE" targetName="NUMLOTE" />
            <field localName="CODPARC" targetName="CODPARC" />
            <field localName="CODCENCUS" targetName="CODCENCUS" />
          </fields>
        </relation>
      </relationShip>
      <actions>
        <action type="SP">
          <description><![CDATA[Calcular Adiantamentos]]></description>
          <actionConfig>
            <dbCall name="AD_STP_FCR_CALC_ADIANT_SF" refreshType="SEL" txManual="false" rootEntity="AD_TSFFCR" />
            <params>
              <promptParam label="Primeiro Vencimento" name="DTVENCINI" required="false" saveLast="false" paramType="DT" />
            </params>
          </actionConfig>
          <storedProcedure><![CDATA[CREATE OR REPLACE  PROCEDURE "AD_STP_FCR_CALC_ADIANT_SF" (p_codusu    number,
                                                      p_idsessao  varchar2,
                                                      p_qtdlinhas number,
                                                      p_mensagem  out varchar2) as

 p_dtvencini date;

 fcr ad_tsffcr%rowtype;
 i   int;
begin

 /**
 * Autor: M. rangel
 * Processo: Fechamento de Comissão - Integrado Recria
 * Objetivo: Popular a aba adiantamentos da tela de fechamento de comissão recria
 **/

 -- verifica linhas selecionadas
 if nvl(p_qtdlinhas, 0) > 1 then
  p_mensagem := 'Selecione apenas 1 lote!';
  return;
 end if;

 p_dtvencini := act_dta_param(p_idsessao, 'DTVENCINI');

 --- popula record
 begin
  select *
    into fcr
    from ad_tsffcr
   where codcencus = act_int_field(p_idsessao, 1, 'CODCENCUS')
     and codparc = act_int_field(p_idsessao, 1, 'CODPARC')
     and numlote = act_int_field(p_idsessao, 1, 'NUMLOTE');
 exception
  when others then
   p_mensagem := 'Erro ao buscar os dados do registro selecionado. ' || sqlerrm;
   return;
 end;

 -- valida preenchimento de campos importantes
 if nvl(fcr.codemp, 0) = 0 or fcr.dtaloj is null or nvl(fcr.qtdmeses, 0) = 0 or
    nvl(fcr.qtdaves, 0) = 0 then
  p_mensagem := 'As informações complementares sobre o lote, como <b>Empresa</b>, ' ||
                '<b>Data de Alojamento</b> e <b>Quantidade de meses</b> ' ||
                'são necessárias para a geração das parcelas.';
  return;
 end if;

 -- valida status
 if fcr.status = 'F' then
  p_mensagem := 'Lote já finalizado!';
  return;
 end if;

 -- verifica adiantamentos gerados
 select count(nuacerto)
   into i
   from ad_tsffcradt
  where 1 = 1
    and codcencus = fcr.codcencus
    and codparc = fcr.codparc
    and numlote = fcr.numlote;

 -- Não possui adiantamentos
 if i = 0 then
 
  if p_dtvencini is null and fcr.status = 'P' then
   p_mensagem := 'Necessário informar o vencimento para o primeiro cálculo!';
   return;
  end if;
 
  --** método de calculo/recalculo
  ad_stp_fcr_recalcfechamento_sf(fcr.codcencus, fcr.codparc, fcr.numlote, trunc(sysdate), fcr);
 
  -- atualizar os valores previstos
  stp_set_atualizando('S');
 
  fcr.vlrmesprev  := snk_dividir(fcr.totremave * fcr.qtdavesliq, fcr.qtdmeses);
  fcr.qtdmortperm := fcr.qtdaves * (fcr.percmortprev / 100);
  begin
   update ad_tsffcr r
      set r.codtabprev  = fcr.codtabreal,
          r.dreftabprev = fcr.dreftabreal,
          r.vlrunitprev = fcr.totremave,
          r.vlrtotprev  = fcr.totremave * fcr.qtdavesliq,
          r.vlrmesprev  = fcr.vlrmesprev,
          r.pontuacao   = 100,
          r.status      = 'A',
          r.statuslote  = 'A',
          r.qtdmortperm = fcr.qtdmortperm
    where codcencus = fcr.codcencus
      and codparc = fcr.codparc
      and numlote = fcr.numlote;
  exception
   when others then
    p_mensagem := 'Erro ao atualizar os valores previstos. ' || sqlerrm;
    return;
  end;
 
  -- exclui lançamentos existentes
  begin
   delete from ad_tsffcradt
    where codcencus = fcr.codcencus
      and codparc = fcr.codparc
      and numlote = fcr.numlote;
  exception
   when others then
    p_mensagem := 'Erro ao excluir previsões de adiantamentos existentes' || sqlerrm;
    return;
  end;
 
  -- insere previsões de adiantamentos
  for m in 1 .. fcr.qtdmeses
  loop
  
   begin
    insert into ad_tsffcradt
     (codcencus, codparc, numlote, nuadt, desdobramento, dtref, vlrprev, vlradiant, nuacerto,
      dtvenc)
    values
     (fcr.codcencus, fcr.codparc, fcr.numlote, m, m, trunc(add_months(fcr.dtaloj, m - 1), 'fmmm'),
      fcr.vlrmesprev, 0, null, add_months(p_dtvencini, m - 1));
   exception
    when others then
     p_mensagem := 'Erro ao inserir previsão de adiantamento. ' || sqlerrm;
     return;
   end;
  
  end loop;
  stp_set_atualizando('N');
  --Sim, possui adiantamentos gerados
 else
  -- recalcula os valores reais
  ad_stp_fcr_recalcfechamento_sf(fcr.codcencus, fcr.codparc, fcr.numlote, trunc(sysdate), fcr);
 
  -- tratativa para quando há reajuste de valor
 
  /* caso de uso
  Inicialmente foram calculadas 6 parcelas de R$ 10.000,00 cada, 
  sendo que já foi feito adiantamento de 2 parcelas, ou seja, foram adiantados R$ 20.000,00. 
  Ao conceder o terceiro adiantamento, em função de nova tabela o valor de cada parcela 
  passou de R$ 10.000,00 para R$ 12.000,00, como o reajuste é retroativo, 
  o integrado passa a ter direito a receber R$ 12.000,00 da terceira parcela, 
  e a diferença do reajuste das duas parcelas anteriores, ou seja, R$ 2.000,00 da parcela 1 
  e R$ 2.000,00 da parcela 2, logo a terceira parcela será gerada no valor total de R$ 16.000,00.*/
  declare
   v_vlrdif float := 0;
   d        int := 0;
  begin
   i := 0;
   for m in (select a.*, rowid
               from ad_tsffcradt a
              where a.codcencus = fcr.codcencus
                and a.codparc = fcr.codparc
                and a.numlote = fcr.numlote
              order by a.desdobramento)
   loop
   
    --- verifica se há alteração de valor, se houver, captura a diferença
    if m.vlrprev != fcr.vlrmesprev and m.nuacerto is not null then
     v_vlrdif := v_vlrdif + (fcr.vlrmesprev - m.vlrprev);
     continue;
    end if;
   
    -- se já possui adiantamento gerado, pula
    if m.nuacerto is not null then
     continue;
    end if;
   
    -- se possui nova data de vencimento
    --- altera o valor e a dt venc
    if p_dtvencini is not null then
     update ad_tsffcradt a
        set a.vlradiant = fcr.vlrmesprev,
            a.dtvenc    = add_months(p_dtvencini, d)
      where a.rowid = m.rowid;
    
     d := d + 1;
     --- se não, altera só o valor
    else
     update ad_tsffcradt a set a.vlradiant = fcr.vlrmesprev where a.rowid = m.rowid;
    end if;
   
    -- corrige o valor com as diferenças retroativas
    if v_vlrdif > 0 and i = 0 then
     update ad_tsffcradt a set a.vlradiant = fcr.vlrmesprev + v_vlrdif where a.rowid = m.rowid;
     i := i + 1;
    end if;
   
   end loop;
  
  end;
 
 end if;

 /*@Nesse momento o fechamento estatrá "Em andamento", as previsões de adiantamento estarão 
 geradas, de acordo com a quantidade de meses, não será possível alterar manualmente os 
 valores no mainform, será possível recalcular*/
 stp_set_atualizando('N');

 p_mensagem := 'Cálculo realizado com Sucesso!!!';

end;]]></storedProcedure>
        </action>
        <action type="SP">
          <description><![CDATA[Fechar Comissão]]></description>
          <actionConfig>
            <dbCall name="AD_STP_FCR_FECHAMENTO_SF" refreshType="SEL" txManual="false" rootEntity="AD_TSFFCR" />
            <params>
              <promptParam label="Novo Vencimento" name="DTVENC" required="false" saveLast="false" paramType="DT" />
              <promptParam label="Pontuação" name="PONTUACAO" required="true" saveLast="false" precision="" paramType="I" />
              <promptParam label="Mortalidade Transporte" name="QTDMORTRANSP" required="true" saveLast="false" precision="" paramType="I" />
              <promptParam label="Envio Laboratório" name="QTDENVLAB" required="true" saveLast="false" precision="" paramType="I" />
              <promptParam label="Mortalidade na Granja" name="QTDMORTGRANJA" required="true" saveLast="false" precision="" paramType="I" />
              <promptParam label="Aves Vendidas" name="QTDAVESVDA" required="true" saveLast="false" precision="" paramType="I" />
              <promptParam label="Aves Eliminadas-Sexagem" name="QTDAVESELIM" required="true" saveLast="false" precision="" paramType="I" />
            </params>
          </actionConfig>
          <storedProcedure><![CDATA[CREATE OR REPLACE  PROCEDURE "AD_STP_FCR_FECHAMENTO_SF" (p_codusu    number,
                                                     p_idsessao  varchar2,
                                                     p_qtdlinhas number,
                                                     p_mensagem  out varchar2) as
 p_dtvenc        date;
 p_pontuacao     number;
 p_qtdmortransp  number;
 p_qtdenvlab     number;
 p_qtdmortgranja number;
 p_qtdavesvda    number;
 p_qtdaveselim   number;

 fcr ad_tsffcr%rowtype;
 adt ad_tsffcradt%rowtype;
 i   int;

begin

 /*
 * Autor: M. Rangel
 * Processo: Fechamento de comissão do integrado recria
 * Objetivo: Realizar o fechamento do lote, botão de ação homônima na tela.
             O mesmo só pode ser realizado quando apenas a última parcela estiver
             pendente de geração.
 */

 p_dtvenc        := act_dta_param(p_idsessao, 'DTVENC');
 p_pontuacao     := act_int_param(p_idsessao, 'PONTUACAO');
 p_qtdmortransp  := act_int_param(p_idsessao, 'QTDMORTRANSP');
 p_qtdenvlab     := act_int_param(p_idsessao, 'QTDENVLAB');
 p_qtdmortgranja := act_int_param(p_idsessao, 'QTDMORTGRANJA');
 p_qtdavesvda    := act_int_param(p_idsessao, 'QTDAVESVDA');
 p_qtdaveselim   := act_int_param(p_idsessao, 'QTDAVESELIM');

 if p_qtdlinhas > 1 then
  p_mensagem := 'Selecione apenas um registro!';
  return;
 end if;

 select *
   into fcr
   from ad_tsffcr
  where codcencus = act_int_field(p_idsessao, 1, 'CODCENCUS')
    and codparc = act_int_field(p_idsessao, 1, 'CODPARC')
    and numlote = act_int_field(p_idsessao, 1, 'NUMLOTE');

 begin
  select *
    into adt
    from ad_tsffcradt a
   where 1 = 1
     and a.codcencus = fcr.codcencus
     and a.codparc = fcr.codparc
     and a.numlote = fcr.numlote
        --and a.desdobramento != fcr.qtdmeses
     and a.nuacerto is null;
 exception
  when no_data_found then
   p_mensagem := 'A última parcela tem que estar pendente de adiantamento.<br>' ||
                 'Cancelando operação!';
   return;
  when too_many_rows then
   p_mensagem := 'É necessário que somente a última parcela esteja pendente.<br>' ||
                 'Cancelando a operação!';
   return;
  when others then
   raise;
 end;

 --get valores da tabela
 ad_stp_fcp_getreftabela_sf(p_codcencus => fcr.codcencus,
                            p_dtref     => adt.dtref,
                            p_codtab    => fcr.codtabreal,
                            p_dtreftab  => fcr.dreftabreal,
                            p_recoper   => fcr.vlrcomfixa,
                            p_recatrat  => fcr.vlrcomatrat,
                            p_recbonus  => fcr.vlrcomclist,
                            p_rectotal  => fcr.vlrunitprev,
                            p_custo     => fcr.vlrcomave);

 -- atualiza dados no formulario principal
 begin
  fcr.totremave     := fcr.vlrcomfixa + fcr.vlrcomatrat + fcr.vlrcomclist;
  fcr.qtdavesliq    := (fcr.qtdaves - p_qtdmortransp - p_qtdenvlab);
  fcr.totavestransf := fcr.qtdavesliq - (p_qtdmortgranja + p_qtdavesvda + p_qtdaveselim);
  fcr.vlrtotreal    := fcr.totremave * fcr.qtdavesliq;
 
  stp_set_atualizando('S');
  update ad_tsffcr r
     set r.codtabreal    = fcr.codtabreal,
         r.dreftabreal   = fcr.dreftabreal,
         r.vlrcomfixa    = fcr.vlrcomfixa,
         r.vlrcomatrat   = fcr.vlrcomatrat,
         r.vlrcomave     = fcr.vlrcomave,
         r.pontuacao     = p_pontuacao,
         r.vlrcomclist   = fcr.vlrcomclist * (p_pontuacao / 100),
         r.totremave     = fcr.totremave,
         r.totremmes     = fcr.totremave / r.qtdmeses,
         r.qtdavesliq    = fcr.qtdavesliq,
         r.qtdmortgranja = p_qtdmortgranja,
         r.qtdavesvda    = p_qtdavesvda,
         r.qtdaveselim   = p_qtdaveselim,
         r.totavestransf = fcr.totavestransf,
         r.vlrtotreal    = fcr.vlrtotreal,
         r.vlrmedreal    = fcr.vlrtotreal / fcr.qtdmeses,
         r.statuslote    = 'F',
         r.codusualt     = p_codusu,
         r.dhalter       = sysdate
   where r.codcencus = fcr.codcencus
     and r.codparc = fcr.codparc
     and r.numlote = fcr.numlote;
  stp_set_atualizando('S');
 exception
  when others then
   p_mensagem := 'Erro ao atualizar o formulário principal. ' || sqlerrm;
   return;
 end;

 <<valida_venc>>
 begin
  if p_dtvenc is not null and to_char(p_dtvenc, 'd') in (1, 7) then
   p_dtvenc := p_dtvenc + 1;
   goto valida_venc;
  end if;
 end;

 begin
  update ad_tsffcradt a
     set a.vlradiant = fcr.vlrtotreal - fcr.vlrtotadiant,
         a.dtvenc    = nvl(p_dtvenc, a.dtvenc)
   where a.codcencus = fcr.codcencus
     and a.codparc = fcr.codparc
     and a.numlote = fcr.numlote
     and a.desdobramento = fcr.qtdmeses;
 exception
  when others then
   p_mensagem := 'Erro ao atualizar os dados do adiantamento. ' || sqlerrm;
   return;
 end;

 p_mensagem := 'Lote de Comissão fechado com sucesso!!!';

end;]]></storedProcedure>
        </action>
        <action type="SP">
          <description><![CDATA[Gerar Pedido/Nota]]></description>
          <actionConfig>
            <dbCall name="AD_STP_FCR_GERA_NOTA_SF" refreshType="SEL" txManual="false" rootEntity="AD_TSFFCR" />
          </actionConfig>
          <storedProcedure><![CDATA[CREATE OR REPLACE  PROCEDURE "AD_STP_FCR_GERA_NOTA_SF" (p_codusu    number,
                                                    p_idsessao  varchar2,
                                                    p_qtdlinhas number,
                                                    p_mensagem  out varchar2) as

 fcr ad_tsffcr%rowtype;
 cfg ad_tsffciconf%rowtype;
 mgn ad_tsfmgn%rowtype;

 v_nufin  number;
 v_dtvenc date;
 v_modelo int;
 i        int;
begin

 /*
 * Autor: M. Rangel
 * Processo: Fechamento da comissão da Recria
 * Objetivo: Ação "Gerar notas" da tela de fechamento da comissão da recria.
             Tem por objetivo permitir a criação dos documentos exigidos pelo 
             processo, considerando a questão de dentro ou fora da UF GO, permitindo
             escolher entre gerar a nota de compra ou o pedido de compra (no caso do PR).
             As informações para a geração da nota, como top, natureza, estão na tela de
             modelos para geração de notas (TSFMGN).
 */

 if p_qtdlinhas > 1 then
  p_mensagem := 'Selecione apenas 1 registro.';
  return;
 end if;

 select *
   into fcr
   from ad_tsffcr a
  where a.codcencus = act_int_field(p_idsessao, 1, 'CODCENCUS')
    and a.codparc = act_int_field(p_idsessao, 1, 'CODPARC')
    and a.numlote = act_int_field(p_idsessao, 1, 'NUMLOTE');

 -- valida nunota
 if fcr.nunota is not null then
  p_mensagem := 'Comissão já possui nota gerada!';
  return;
 end if;

 -- valida se adiantamentos estão gerados
 select count(*)
   into i
   from ad_tsffcradt a
  where a.codcencus = fcr.codcencus
    and a.codparc = fcr.codparc
    and a.numlote = fcr.numlote
    and a.nuacerto is null;

 if i > 0 then
  p_mensagem := 'Para a geração das notas, é necessário que todos os ' ||
                'adiantamentos tenham sido gerados';
  return;
 end if;

 -- busca set de parametros
 ad_pkg_fci.get_config(trunc(sysdate), cfg);

 /*begin
  select *
    into conf
    from ad_tsffciconf c
   where c.dtvigor = (select max(dtvigor)
                        from ad_tsffciconf c2
                       where c2.nuconf = c.nuconf
                         and c2.dtvigor <= sysdate);
 exception
  when no_data_found then
   p_mensagem := 'Erro ao buscar as configuração da ' || 'tela de parâmetros. ' || sqlerrm;
   return;
 end;*/

 if ad_get.ufparcemp(fcr.codparc, 'P') = ad_get.ufparcemp(fcr.codemp, 'E') then
  v_modelo := cfg.numodcparec;
 else
  v_modelo := cfg.numodpcarec;
 end if;

 begin
  select * into mgn from ad_tsfmgn where numodelo = v_modelo;
 exception
  when others then
   raise;
 end;

 begin
  -- insere cabeçalho
  ad_set.ins_pedidocab(p_codemp      => fcr.codemp,
                       p_codparc     => fcr.codparc,
                       p_codvend     => mgn.codvend,
                       p_codtipoper  => mgn.codtipoper,
                       p_codtipvenda => mgn.codtipvenda,
                       p_dtneg       => trunc(sysdate),
                       p_vlrnota     => fcr.vlrtotreal,
                       p_codnat      => mgn.codnat,
                       p_codcencus   => fcr.codcencus,
                       p_codproj     => 0,
                       p_obs         => 'Fech. Com. Recria - nº lote: ' || fcr.numlote,
                       p_nunota      => fcr.nunota);
  -- insere item
  ad_set.ins_pedidoitens(p_nunota   => fcr.nunota,
                         p_codprod  => mgn.codprod,
                         p_qtdneg   => fcr.participacao,
                         p_codvol   => mgn.codvol,
                         p_codlocal => mgn.codlocal,
                         p_controle => null,
                         p_vlrunit  => fcr.vlrcomave,
                         p_vlrtotal => fcr.vlrtotreal,
                         p_mensagem => p_mensagem);
 
  if p_mensagem is not null then
   return;
  end if;
 
  begin
  
   -- try dia do vencimento fds
   v_dtvenc := add_months(sysdate, 12);
   <<check_dia_vencto>>
   begin
    if to_number(to_char(v_dtvenc, 'd')) in (1, 7) then
     v_dtvenc := v_dtvenc + 1;
     goto check_dia_vencto;
    end if;
   end;
  
   ad_set.ins_financeiro(p_codemp     => fcr.codemp,
                         p_numnota    => 0,
                         p_dtneg      => trunc(sysdate),
                         p_dtvenc     => v_dtvenc,
                         p_codparc    => fcr.codparc,
                         p_top        => mgn.codtipoper,
                         p_contabanco => mgn.codctabcoint,
                         p_codnat     => mgn.codnat,
                         p_codcencus  => fcr.codcencus,
                         p_codproj    => 0,
                         p_codtiptit  => mgn.codtiptit,
                         p_origem     => 'E',
                         p_nunota     => fcr.nunota,
                         p_valor      => fcr.vlrtotreal,
                         p_nufin      => v_nufin,
                         p_errmsg     => p_mensagem);
  
   if p_mensagem is not null then
    return;
   end if;
  
  exception
   when others then
    p_mensagem := sqlerrm;
    return;
  end;
 
  -- atualiza dados na origem
 
  stp_set_atualizando('S');
 
  begin
   update ad_tsffcr r
      set r.nunota     = fcr.nunota,
          r.status     = 'F',
          r.statusnota = 'A'
    where r.codcencus = fcr.codcencus
      and r.codparc = fcr.codparc
      and r.numlote = fcr.numlote;
  exception
   when others then
    p_mensagem := sqlerrm;
    return;
  end;
 
  -- confirma pedido de compra
  if nvl(mgn.confauto, 'N') = 'S' then
  
   if act_confirmar('Confirmação de Nota', 'Deseja confirmar a nota Gerada?', p_idsessao, 1) then
   
    stp_confirmanota_java_sf(fcr.nunota);
   
    --select * into cab from tgfcab where nunota = fcr.nunota;
   
    -- atualiza informações na origem
    update ad_tsffcr r
       set r.statusnota = 'L',
           r.dhalter    = sysdate,
           r.codusualt  = p_codusu
     where nunota = fcr.nunota;
   
   end if;
  
  end if;
 
  stp_set_atualizando('N');
 
 end;

 p_mensagem := 'Nota nº único ' || '<a title="Clique aqui" target="_parent" href="' ||
               ad_fnc_urlskw('TGFCAB', fcr.nunota) || '">' || fcr.nunota || '</a>' ||
               ' gerada com sucesso!';

end;]]></storedProcedure>
        </action>
      </actions>
    </instance>
    <instance name="AD_TSFFCRADT">
      <instanceDescription><![CDATA[Adiantamentos]]></instanceDescription>
      <tableInfo name="AD_TSFFCRADT" sequenceType="A" sequenceField="NUADT">
        <category><![CDATA[Integrado - Comissão Recria]]></category>
        <tableDescription><![CDATA[Adiantamentos]]></tableDescription>
        <primaryKey>
          <CODCENCUS />
          <CODPARC />
          <NUMLOTE />
          <NUADT />
        </primaryKey>
      </tableInfo>
      <fields>
        <field name="CODCENCUS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Cód. Centro de Resultados]]></description>
          <properties>
            <prop name="nullable"><![CDATA[N]]></prop>
            <prop name="visivel"><![CDATA[N]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="CODPARC" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Cód. Parceiro]]></description>
          <properties>
            <prop name="nullable"><![CDATA[N]]></prop>
            <prop name="visivel"><![CDATA[N]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="NUMLOTE" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Nro Lote]]></description>
          <properties>
            <prop name="nullable"><![CDATA[N]]></prop>
            <prop name="visivel"><![CDATA[N]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="NUADT" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[NUADT]]></description>
          <properties>
            <prop name="nullable"><![CDATA[N]]></prop>
            <prop name="visivel"><![CDATA[N]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="DESDOBRAMENTO" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Desdobramento]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="DTREF" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Referência]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="VLRPREV" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. Previsto]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="gridFooterOper"><![CDATA[sum]]></prop>
          </properties>
        </field>
        <field name="VLRADIANT" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Vlr. do Adiantamento]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[2]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
            <prop name="gridFooterOper"><![CDATA[sum]]></prop>
          </properties>
        </field>
        <field name="DTVENC" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Dt. Vencimento]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="NUACERTO" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="N" visibleOnSearch="S" allowNull="S" size="10">
          <description><![CDATA[Nro Adiantamento]]></description>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
      </fields>
      <relationShip>
        <relation entityName="AcertoFrete" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TGFFRE" />
          <expression><![CDATA[@ref-param[force-one-to-one=true]]]></expression>
          <fields>
            <field localName="NUACERTO" targetName="NUACERTO" />
          </fields>
        </relation>
      </relationShip>
      <actions>
        <action type="SP">
          <description><![CDATA[Gerar Adiantamento]]></description>
          <actionConfig>
            <dbCall name="AD_STP_FCR_GERA_ADIANT_SF" refreshType="ALL" txManual="false" rootEntity="AD_TSFFCRADT" />
          </actionConfig>
          <storedProcedure><![CDATA[CREATE OR REPLACE  PROCEDURE "AD_STP_FCR_GERA_ADIANT_SF" (p_codusu    number,
                                                      p_idsessao  varchar2,
                                                      p_qtdlinhas number,
                                                      p_mensagem  out varchar2) as

 fcr        ad_tsffcr%rowtype;
 cfg        ad_adtssaconf%rowtype;
 fci        ad_tsffciconf%rowtype;
 fin        tgffin%rowtype;
 fre        tgffre%rowtype;
 v_dtreftab date;
 v_confirma boolean;
 v_gerou    int := 0;

 type linhas_adiant is table of ad_tsffcradt%rowtype;
 adt linhas_adiant := linhas_adiant();

begin
 /*
 * Autor: M. Rangel
 * Processo: Fechamento de comissão Recria
 * Objetivo: Validação e geração dos adiantamentos. Ação "Gerar adiantamento"
             da aba adiantamentos da tela de fechamento recria.
 */

 -- popula com as informações do fechamento
 select *
   into fcr
   from ad_tsffcr f
  where f.codcencus = act_int_field(p_idsessao, 0, 'MASTER_CODCENCUS')
    and f.codparc = act_int_field(p_idsessao, 0, 'MASTER_CODPARC')
    and f.numlote = act_int_field(p_idsessao, 0, 'MASTER_NUMLOTE');

 if fcr.status = 'P' then
  p_mensagem := 'Necessário calcular o adiantamento antes!';
  return;
 end if;

 -- armazena as previsões de adiantmento
 select *
   bulk collect
   into adt
   from ad_tsffcradt a
  where a.codcencus = fcr.codcencus
    and a.codparc = fcr.codparc
    and a.numlote = fcr.numlote
  order by dtvenc;

 -- percorre os adiantamentos
 for l in adt.first .. adt.last
 loop
 
  -- ignora os registros  com nufin gerado
  if adt(l).nuacerto is not null then
   continue;
  else
  
   if Nvl(adt(l).vlradiant,0) = 0 then
      adt(l).vlradiant := adt(l).vlrprev;
   end if; 
  
   -- busca os dados da tela de parametros do Fech. Com. Integrado
   -- cabe um  exception pra tratar a msg de config not found -- 
   ad_pkg_fci.get_config(adt(l).dtref, fci);
    -- busca set de parametros

  
   -- busca a ultima data de atualização de tabela
   select ref.dtref
     into v_dtreftab
     from ad_tsftcp tab
     join ad_tsftcpcus cus
       on cus.codtabpos = tab.codtabpos
     join ad_tsftcpref ref
       on ref.codtabpos = tab.codtabpos
    where cus.codcencus = fcr.codcencus
      and ref.dtref = (select max(dtref)
                         from ad_tsftcpref r2
                        where r2.codtabpos = tab.codtabpos
                          and r2.dtref <= adt(l).dtref);
  
   --- se data do ultimo calculo do lote for menor que a ultima atualização da tabela
   if fcr.dreftabreal < v_dtreftab then
    v_confirma := act_confirmar('Geração de Adiantamentos',
                                'Existe uma atualização de tabela, indicando ' ||
                                'que o lote não foi recalculado, deseja recalcular ' ||
                                'antes de gerar o adiantamento?',
                                p_idsessao,
                                0);
    if v_confirma then
     -- recalcula o lote
     ad_stp_fcr_recalcfechamento_sf(fcr.codcencus, fcr.codparc, fcr.numlote, adt(l).dtref, fcr);
    
     adt(l).vlradiant := ((fcr.totremave * fcr.qtdaves) / fcr.qtdmeses);
    
     --calcular a diferença retroativa de valores
     declare
      vlrdiff float := 0;
      vlrnovo float := adt(l).vlradiant;
     begin
      for val in (select vlrprev, vlradiant
                    from ad_tsffcradt
                   where codcencus = fcr.codcencus
                     and codparc = fcr.codparc
                     and numlote = fcr.numlote
                     and dtref < adt(l).dtref)
      loop
       vlrdiff := vlrdiff + (vlrnovo - val.vlradiant);
      end loop;
      adt(l).vlradiant := vlrnovo + abs(vlrdiff);
     end;
    
    else
     p_mensagem := 'Efetue o recalculo do lote ou a correção da tabela para ' ||
                   'gerar a parcela do adiantamento.';
     return;
    end if;
   
   end if;
  
   -- busca os dados da tela de parametros para adiantamentos ssa
   select * into cfg from ad_adtssaconf c where c.codigo = fci.codconfemprec;
  
  end if;
 
  -- se for a última parcela
  if l = fcr.qtdmeses and fcr.statuslote != 'F' then
   p_mensagem := 'A última parcela do adiantamento só poderá ser gerada ' ||
                 'após a realização da ação de fechamento, pois é necessário ' ||
                 'obter o valor residual dos adiantamentos';
   return;
  end if;
  
      <<valida_venc>>                     
    Begin
     if To_Char(adt(l).dtvenc,'d') In (1,7)  then
        adt(l).dtvenc := adt(l).dtvenc + 1;
        Goto valida_venc;
     end if; 
    End;
 
  -- confirmação de geração da parcela X
  v_confirma := act_confirmar('Geração de Adiantamentos',
                              'Confirma a geração da parcela ' || l || ' no valor de ' ||
                              fmt.valor_moeda(adt(l).vlradiant) || ' com vencimento para ' ||
                              to_char(adt(l).dtvenc, 'dd/MM/yyyy'),
                              p_idsessao,
                              1);
 
  if not v_confirma then
   return;
  end if;
  
  
 
  -- inicio da geração do adiantamento
  begin
  
   stp_keygen_tgfnum('TGFFRE', 1, 'TGFFRE', 'NUACERTO', 0, fre.nuacerto);
   fre.sequencia := 0;
  
   -- prepara para inserir uma receita e uma despesa
   for rec_desp in -1 .. 1
   loop
   
    if rec_desp = 0 then
     continue;
    end if;
   
    stp_keygen_nufin(p_ultcod => fin.nufin);
   
    if rec_desp = 1 then
     fin.codtipoper := cfg.codtipoperrec;
     fin.codtiptit  := cfg.tipotitrec;
     fin.provisao   := 'N';
    else
     fin.codtipoper := cfg.codtipoperdesp;
     fin.codtiptit := 4;
     fin.provisao := 'S';
     adt(l).nuacerto := fre.nuacerto;
    end if;
   
    fin.dhtipoper := ad_get.maxdhtipoper(fin.codtipoper);
    fin.historico := 'Ref. fechamento comissão recriar - lote ' || adt(l).numlote || '. ' ||
                     'Parcela ' || adt(l).desdobramento || ' de ' || adt.count;
   
    Insert into tgffin
     (nufin, codemp, numnota, dtneg, desdobramento, dhmov, dtvenc, dtvencinic, codparc, codtipoper,
      dhtipoper, codctabcoint, codnat, codcencus, codproj, codtiptit, vlrdesdob, vlrjuronegoc,
      recdesp, provisao, origem, codusu, dtalter, desdobdupl, historico, codbco, ad_variacao)
    values
     (fin.nufin, fcr.codemp, fcr.numlote, trunc(sysdate), adt(l).desdobramento, sysdate,
      adt(l).dtvenc, adt(l).dtvenc, fcr.codparc, fin.codtipoper, fin.dhtipoper, cfg.codctabcoint,
      fci.codnatadiant, fcr.codcencus, 0, fin.codtiptit, adt(l).vlradiant, 0, rec_desp, fin.provisao, 'F',
      p_codusu, sysdate, 'ZZ', fin.historico, 1, 'comrecria');
   
    fre.sequencia := fre.sequencia + 1;
   
    insert into tgffre
     (nuacerto, nunota, nufin, nufinorig, codusu, dhalter, tipacerto, sequencia, nuedi)
    values
     (fre.nuacerto, null, fin.nufin, null, p_codusu, sysdate, 'A', fre.sequencia, null);
   
    update tgffin f set f.nucompens = fre.nuacerto where nufin = fin.nufin;
   
    -- se exige aprovação e é a despesa do adiantmento
    if cfg.exigaprdesp = 'S' and rec_desp = -1 then
     -- insere liberação
     ad_set.ins_liberacao('TGFFIN',
                          fin.nufin,
                          1035,
                          adt(l).vlradiant,
                          cfg.codusuapr,
                          'Ref. Com. Recria, lote ' || fcr.numlote || ', parcela ' ||
                          to_char(adt(l).desdobramento) || ' de ' || adt.count,
                          p_errmsg => p_mensagem);
    
     if p_mensagem is not null then
      return;
     end if;
    
    end if;
   
   end loop;
   -- loop do financeiro
  
   begin
    -- atualiza o total do adiantamento gerado no mainform
    stp_set_atualizando('S');
    
    Select Sum(vlradiant) 
    Into fcr.vlrtotadiant
    From ad_tsffcradt 
    Where codcencus = fcr.codcencus
     And codparc = fcr.codparc
     And numlote = fcr.numlote;
    
    fcr.vlrtotreal := fcr.totremave * fcr.qtdavesliq;
    
    update ad_tsffcr f
       set f.vlrtotreal = fcr.vlrtotreal,
           f.vlrtotadiant = fcr.vlrtotadiant + adt(l).vlradiant,
           f.saldo = case
                      when nvl(f.vlrtotreal, 0) > 0 then
                       fcr.vlrtotreal - (fcr.vlrtotadiant + adt(l).vlradiant)
                      else
                       0
                     end
     where f.codcencus = fcr.codcencus
       and f.codparc = fcr.codparc
       and f.numlote = fcr.numlote;
   
    -- devolve o nuacerto gerado
    update ad_tsffcradt a
       set a.nuacerto  = fre.nuacerto,
           a.vlradiant = adt(l).vlradiant
     where a.codcencus = fcr.codcencus
       and a.codparc = fcr.codparc
       and a.numlote = fcr.numlote
       and a.nuadt = adt(l).nuadt;
   
    stp_set_atualizando('N');
   exception
    when others then
     p_mensagem := 'Erro ao atualizar o número único do adiantamento. ' || sqlerrm;
     return;
   end;
  
  end;
  -- fim da geração do adiantamento
 
  exit;
 
 end loop;

 p_mensagem := 'Adiantamento gerado com sucesso!!!';

end;]]></storedProcedure>
        </action>
      </actions>
    </instance>
    <instance name="AD_TSFTCPCUS">
      <instanceDescription><![CDATA[Centro de Custos]]></instanceDescription>
      <tableInfo name="AD_TSFTCPCUS" sequenceType="M">
        <category><![CDATA[Integração - Comissão Postura]]></category>
        <tableDescription><![CDATA[Centro de Custos]]></tableDescription>
        <primaryKey>
          <CODTABPOS />
          <CODCENCUS />
        </primaryKey>
      </tableInfo>
      <fields>
        <field name="CODCENCUS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N" size="10">
          <description><![CDATA[Cód. Centro de Custo]]></description>
        </field>
        <field name="CODTABPOS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Cód. Tabela]]></description>
        </field>
      </fields>
      <relationShip>
        <relation entityName="CentroResultado" type="I" insert="N" update="N" remove="N">
          <targetInfo systemInstance="S" tableName="TSICUS" />
          <fields>
            <field localName="CODCENCUS" targetName="CODCENCUS" />
          </fields>
        </relation>
      </relationShip>
    </instance>
    <instance name="AD_TSFTCP">
      <instanceDescription><![CDATA[Tabela Comissão Postura/Recria]]></instanceDescription>
      <tableInfo name="AD_TSFTCP" sequenceType="A" sequenceField="CODTABPOS" presentationField="DESCRTAB">
        <category><![CDATA[Integração - Comissão Postura]]></category>
        <telaDescription><![CDATA[Autor: M. Rangel
Tabela de Comissão para Postura]]></telaDescription>
        <tableDescription><![CDATA[Tabela Comissão Postura]]></tableDescription>
        <primaryKey>
          <CODTABPOS />
        </primaryKey>
      </tableInfo>
      <fields>
        <field name="CODTABPOS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N" size="10">
          <description><![CDATA[Cód. Tabela]]></description>
        </field>
        <field name="DESCRTAB" systemField="N" dataType="S" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Descrição da Tabela]]></description>
        </field>
      </fields>
      <relationShip>
        <relation entityName="AD_TSFTCPREF" type="I" insert="N" update="N" remove="S">
          <targetInfo systemInstance="N" tableName="AD_TSFTCPREF" />
          <fields>
            <field localName="CODTABPOS" targetName="CODTABPOS" />
          </fields>
        </relation>
        <relation entityName="AD_TSFTCPOVO" type="I" insert="N" update="N" remove="S">
          <targetInfo systemInstance="N" tableName="AD_TSFTCPOVO" />
          <fields>
            <field localName="CODTABPOS" targetName="CODTABPOS" />
          </fields>
        </relation>
        <relation entityName="AD_TSFTCPCUS" type="I" insert="N" update="N" remove="S">
          <targetInfo systemInstance="N" tableName="AD_TSFTCPCUS" />
          <fields>
            <field localName="CODTABPOS" targetName="CODTABPOS" />
          </fields>
        </relation>
      </relationShip>
    </instance>
    <instance name="AD_TSFTCPREF">
      <instanceDescription><![CDATA[Referência]]></instanceDescription>
      <tableInfo name="AD_TSFTCPREF" sequenceType="M">
        <category><![CDATA[Integração - Comissão Postura]]></category>
        <telaDescription><![CDATA[Aba "Referência" da tela de cadastro da Tabela de Comissão Postura]]></telaDescription>
        <tableDescription><![CDATA[Referência]]></tableDescription>
        <primaryKey>
          <CODTABPOS />
          <DTREF />
        </primaryKey>
      </tableInfo>
      <fields>
        <field name="DTREF" systemField="N" dataType="D" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Dt. Referência]]></description>
        </field>
        <field name="CODTABPOS" systemField="N" dataType="I" presentationType="P" calculated="N" allowSearch="S" allowDefault="S" visibleOnSearch="S" allowNull="N">
          <description><![CDATA[Cód. Tabela]]></description>
        </field>
        <field name="RECOPER" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Receita Operacional]]></description>
          <expression><![CDATA[if($valorCampo == null){           
      return java.math.BigDecimal.ZERO;
} $valorCampo;]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="RECATRAT" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Receita Atratividade]]></description>
          <expression><![CDATA[if($valorCampo == null){           
      return java.math.BigDecimal.ZERO;
} $valorCampo;]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="RECBONUS" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Receita Bônus]]></description>
          <expression><![CDATA[if($valorCampo == null){           
      return java.math.BigDecimal.ZERO;
} $valorCampo;]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[N]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
        <field name="RECTOTAL" systemField="N" dataType="F" presentationType="P" calculated="N" allowSearch="N" allowDefault="S" visibleOnSearch="S" allowNull="S">
          <description><![CDATA[Receita Total]]></description>
          <expression><![CDATA[$col_RECOPER .add($col_RECATRAT).add($col_RECBONUS);]]></expression>
          <properties>
            <prop name="nullable"><![CDATA[S]]></prop>
            <prop name="visivel"><![CDATA[S]]></prop>
            <prop name="nuCasasDecimais"><![CDATA[4]]></prop>
            <prop name="readOnly"><![CDATA[S]]></prop>
            <prop name="requerido"><![CDATA[N]]></prop>
            <prop name="combobox"><![CDATA[N]]></prop>
          </properties>
        </field>
      </fields>
    </instance>
  </instances>
</metadata>

